<!doctype html>
<html lang="zh">

<head>
	<title>品牌管理 - 艺格管理系统</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<!-- VENDOR CSS -->
	<link rel="stylesheet" href="../../css/bootstrap-table.css" >
	<link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/vendor/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/vendor/linearicons/style.css">

	<!-- MAIN CSS -->
	<link rel="stylesheet" href="assets/css/main.css">
	<link rel="stylesheet" href="assets/css/demo.css">
	<link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
	<link rel="icon" type="image/png" sizes="96x96" href="assets/img/favicon.png">
</head>

<body>
<!-- WRAPPER -->
<div id="wrapper">
	<!-- NAVBAR -->
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="brand">
			<a href="#"><img src="assets/img/yigeguanli.png" alt="Klorofil Logo" class="img-responsive logo"></a>
		</div>
		<div class="container-fluid">
			<div class="navbar-btn">
				<button type="button" class="btn-toggle-fullwidth"><i class="lnr lnr-arrow-left-circle"></i></button>
			</div>
			<form class="navbar-form navbar-left">
				<!--<div class="input-group">
                    <input type="text" value="" class="form-control" placeholder="Search dashboard...">
                    <span class="input-group-btn"><button type="button" class="btn btn-primary">Go</button></span>
                </div>-->
			</form>
			<div class="navbar-btn navbar-btn-right">
			</div>
			<div id="navbar-menu">
				<ul class="nav navbar-nav navbar-right">
					<li class="dropdown">
						<!--<a href="#" class="dropdown-toggle icon-menu" data-toggle="dropdown">
                            <i class="lnr lnr-alarm"></i>
                            <span class="badge bg-danger">5</span>
                        </a>-->
						<ul class="dropdown-menu notifications">
							<li><a href="#" class="notification-item"><span class="dot bg-warning"></span>System space is almost full</a></li>
							<li><a href="#" class="notification-item"><span class="dot bg-danger"></span>You have 9 unfinished tasks</a></li>
							<li><a href="#" class="notification-item"><span class="dot bg-success"></span>Monthly report is available</a></li>
							<li><a href="#" class="notification-item"><span class="dot bg-warning"></span>Weekly meeting in 1 hour</a></li>
							<li><a href="#" class="notification-item"><span class="dot bg-success"></span>Your request has been approved</a></li>
							<li><a href="#" class="more">See all notifications</a></li>
						</ul>
					</li>
					<li class="dropdown">
						<!--<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="lnr lnr-question-circle"></i> <span>Help</span> <i class="icon-submenu lnr lnr-chevron-down"></i></a>-->
						<ul class="dropdown-menu">
							<li><a href="#">Basic Use</a></li>
							<li><a href="#">Working With Data</a></li>
							<li><a href="#">Security</a></li>
							<li><a href="#">Troubleshooting</a></li>
						</ul>
					</li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src="assets/img/user.png" class="img-circle" alt="Avatar"> <span>Samuel</span> <i class="icon-submenu lnr lnr-chevron-down"></i></a>
						<ul class="dropdown-menu">
							<li><a href="#"><i class="lnr lnr-user"></i> <span>我的信息</span></a></li>
							<li><a href="#"><i class="lnr lnr-exit"></i> <span>注销</span></a></li>
						</ul>
					</li>
					<!-- <li>
                        <a class="update-pro" href="#downloads/klorofil-pro-bootstrap-admin-dashboard-template/?utm_source=klorofil&utm_medium=template&utm_campaign=KlorofilPro" title="Upgrade to Pro" target="_blank"><i class="fa fa-rocket"></i> <span>UPGRADE TO PRO</span></a>
                    </li> -->
				</ul>
			</div>
		</div>
	</nav>
	<!-- END NAVBAR -->
	<!-- LEFT SIDEBAR -->
	<div id="sidebar-nav" class="sidebar">
		<div class="sidebar-scroll">
			<nav>
				<ul class="nav">
					<li><a href="dataAnalysis.html" class=""><i class="lnr lnr-home"></i> <span>数据分析</span></a></li>
					<li><a href="userAdmin.html" class=""><i class="lnr lnr-users"></i> <span>用户信息管理</span></a></li>
					<li><a href="goodsAdmin.html" class=""><i class="lnr lnr-code"></i> <span>商品信息管理</span></a></li>
					<li><a href="spuAdmin.html" class=""><i class="lnr lnr-chart-bars"></i> <span>货品信息管理</span></a></li>
					<li><a href="brandAdmin.html" class="active"><i class="lnr lnr-cog"></i> <span>品牌管理</span></a></li>
					<li><a href="typeAdmin.html" class=""><i class="lnr lnr-alarm"></i> <span>分类管理</span></a></li>
					<li><a href="attributeAdmin.html" class=""><i class="lnr lnr-alarm"></i> <span>分类规格管理</span></a></li>
					<li>
						<a href="#subPages" data-toggle="collapse" class="collapsed"><i class="lnr lnr-file-empty"></i> <span>商品上架</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
						<div id="subPages" class="collapse ">
							<ul class="nav">
								<li><a href="putOnSpu.html" class="">上架新货品</a></li>
								<li><a href="putOnGoods.html" class="">上架新商品</a></li>
							</ul>
						</div>
					</li>
					<li>
						<a href="#subPages2" data-toggle="collapse" class="collapsed"><i class="lnr lnr-file-empty"></i> <span>商品下架</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
						<div id="subPages2" class="collapse ">
							<ul class="nav">
								<li><a href="putOffSpu.html" class="">下架货品</a></li>
								<li><a href="putOffGoods.html" class="">下架商品</a></li>
							</ul>
						</div>
					</li>
					<li><a href="deliverGoods.html" class=""><i class="lnr lnr-dice"></i> <span>商品发货</span></a></li>
					<li><a href="commentAdmin.html" class=""><i class="lnr lnr-pencil"></i> <span>评价管理</span></a></li>
					<li><a href="auditAdmin.html" class=""><i class="lnr lnr-text-format"></i> <span>审核管理</span></a></li>
					<li><a href="refundAdmin.html" class=""><i class="lnr lnr-linearicons"></i> <span>退款管理</span></a></li>
				</ul>
			</nav>
		</div>
	</div>
	<!-- END LEFT SIDEBAR -->
	<!-- MAIN -->
	<div class="main">
		<!-- MAIN CONTENT -->
		<div class="main-content">
			<div class="container-fluid">
				<div class="panel panel-headline" style="padding: 20px;">
					<div class="" style="padding-bottom:0;">

						<form id="formSearch" class="form-horizontal">
							<div class="form-group" style="margin-top:0">
								<label class="control-label col-sm-1" for="txtBrandName">品牌名</label>
								<div class="col-sm-3">
									<input type="text" class="form-control" id="txtBrandName">
								</div>
								<label class="control-label col-sm-1" for="txtStatus">状态</label>
								<div class="col-sm-3">
									<!--<input type="text" class="form-control" id="txt_search_statu">-->
									<select id="txtStatus" class="form-control" >
										<option value="">全部</option>
										<option value="0">未授权</option>
										<option value="1">已授权</option>
									</select>
								</div>
								<div class="col-sm-4" style="text-align:left;">
									<button type="button" style="margin-left:50px" id="btn_query" class="btn btn-primary">查询</button>
									<button type="button" style="margin-left:50px" id="btn_clean" class="btn btn-default">清空条件</button>
								</div>
							</div>
						</form>

						<div id="toolbar" class="btn-group">
							<button id="btn_add" type="button" class="btn btn-default" style="">
								<span style="margin-right: 8px;" class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
							</button>
							<!--<button id="btn_edit" type="button" class="btn btn-default">-->
								<!--<span style="margin-right: 8px;" class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改-->
							<!--</button>-->
							<button style="margin-right: 8px;" id="btn_delete" type="button" class="btn btn-danger">
								<span style="margin-right: 8px;" class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
							</button>
						</div>
					</div>
					<table id="table"></table>
				</div>
			</div>
		</div>
		<!-- END MAIN CONTENT -->
	</div>
	<!-- END MAIN -->
	<!--<div class="clearfix"></div>-->
	<!--<footer>-->
		<!--<div class="container-fluid">-->
			<!--<p class="copyright">Copyright &copy; 2017.Company name All rights reserved.More Templates <a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a></p>-->
		<!--</div>-->
	<!--</footer>-->
</div>
<!-- END WRAPPER -->
<!-- 添加信息的模态对话框 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document">
		<div class="modal-content">

			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="exampleModalLabel">新品牌信息</h4>
			</div>

			<div class="modal-body">
				<form>

					<div class="form-group">
						<label for="brand_name" class="control-label">品牌名:</label>
						<input type = "text" class = "form-control" id="brand_name">
					</div>

					<div class="form-group">
						<label for="brand_status" class="control-label">状态:</label>
						<select id="brand_status" class="form-control" >
							<option value="0">未授权</option>
							<option value="1">已授权</option>
						</select>
					</div>

				</form>
			</div>

			<div class="modal-footer bg-info">
				<button type="button" class="btn btn-primary" id="check">确定</button>
				<button type="button" class="btn green" data-dismiss="modal">取消</button>
			</div>

		</div>
	</div>
</div>

<!-- 修改信息的模态对话框 -->
<div class="modal fade" id="otherModal" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document">
		<div class="modal-content">

			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">编辑信息</h4>
			</div>

			<div class="modal-body">
				<form>
					<div class="form-group">
						<label for="inti_id" class="control-label">ID:</label>
						<input type = "text" class=" form-control" id="inti_id" disabled>
					</div>

					<div class="form-group">
						<label for="new_name" class="control-label">品牌名:</label>
						<input type = "text" class = "form-control" id="new_name">
					</div>

					<div class="form-group">
						<label for="new_status" class="control-label">状态:</label>
						<select id="new_status" class="form-control" >
							<option value="0">未授权</option>
							<option value="1">已授权</option>
						</select>
					</div>
				</form>
			</div>

			<div class="modal-footer bg-info">
				<button type="button" class="btn btn-primary" id="update">确定</button>
				<button type="button" class="btn green" data-dismiss="modal">取消</button>
			</div>

		</div>
	</div>
</div>
<!-- Javascript -->
<script src="assets/vendor/jquery/jquery.min.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="assets/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<script src="assets/scripts/klorofil-common.js"></script>
<script type="text/javascript" src="../../js/bootstrap-table.js" ></script>
<script type="text/javascript" src="../../js/bootstrap-table-zh-CN.js"></script>
<script>
    var $table = $('#table');
    var operaEvents;

    //加载网页后的事件
    $().ready(function (){
        //初始化表格
        $('#table').bootstrapTable({
            url:"/brand/list",//要请求数据的文件路径
            method:'post',
            dataType: "json",
            //data: value.data,
            toolbar: '#toolbar',
            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            buttonsAlign:"left",
            pagination: true,                   //是否显示分页（*）
            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页
            pageNumber: 1,                       //初始化加载第一页，默认第一页
            pageSize: 8,                       //每页的记录行数（*）
            pageList: [8, 10],        //可供选择的每页的行数（*）
            queryParamsType : "undefined",     //查询参数组织方式
            queryParams:queryParams,//请求服务器时所传的参数
            contentType:'application/x-www-form-urlencoded; charset=UTF-8',
            responseHandler:function(res){
                //在ajax获取到数据，渲染表格之前，修改数据源
                return res.data;
            },
            columns:
                [{
                    checkbox: true,
                    visible: true                  //是否显示复选框
                }, {
                    field: 'id',
                    sortable:true,
                    title: '品牌编号',
                    width: 150
                }, {
                    field: 'name',
                    sortable:true,
                    title: '品牌名'
                }, {
                    field: 'status',
                    sortable:true,
                    title: '状态',
                    formatter:function(value, row, index) {
                        if(value == '0')
                            return "未授权";
                        else
                            return "已授权";
                    }
                }, {
                    field: 'operation',
                    title: '操作',
                    width: 150,
                    align: 'center',
                    valign: 'middle',
                    events: operaEvents,
                    formatter: operaFormatter()

                }]

        });
    });



    //请求服务数据时所传参数
    function queryParams(params){
        return{
            //每页多少条数据
            pageSize: params.pageSize,
            //请求第几页
            pageIndex:params.pageNumber,
            brandName:$('#txtBrandName').val(),
            brandStatus:$('#txtStatus').val()
        }
    }

    //    操作列的按钮
    function operaFormatter(value, row, index) {
        return [
            '<a id="editor" href="##" class="glyphicon glyphicon-pencil"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;',
            '<a id="remove" href="##" class="glyphicon glyphicon-remove"></a>'
        ].join('')
    }

    //    操作列的按钮事件（单个删除和修改）
    window.operaEvents = {
        'click #remove': function (e, value, row, index) {
			console.log(row);
            var r=confirm("确认删除吗？");
            if (r==true)
            {
                $.ajax({
                    type : "POST",
                    url : "/brand/delete",
                    data:{
                        id: row.id
                    },
                    dataType:"json",
                    success : function (msg) {
                        console.log(msg);
                        if(msg.code==0){
                            console.log("删除成功");
                            $table.bootstrapTable('refresh');
                        }
                        else {
                            alert("删除失败");
                        }
                    },
                    error:function(){
                        console.log("错误");
                    }
                });
            }
            else
            {
                console.log("取消删除");
            }

        },
        'click #editor': function (e, value, row, index) {
            $("#otherModal").modal('show');
            $('#inti_id').val(row.id);
            $('#new_name').val(row.name),
                $('#new_status').val(row.status)
        }
    };

    //    多选删除品牌信息
    $('#btn_delete').click(function () {
        var idArray = new Array();
        //获得选中行
        var checkedbox= $("#table").bootstrapTable('getSelections');
        //将选中行数据转成jsonStr
        var  jsonStr=JSON.stringify(checkedbox);
        //将jsonStr转成jsonObject对象
        var jsonObject=jQuery.parseJSON(jsonStr);
        //接着就可以遍历jsonObject数组对象，取出并操作数据
        if(jsonObject.length==0){
            alert("请勾选需要删除的品牌");
        }
        else {
            for(var i=0;i<jsonObject.length;i++){
                idArray[i] = jsonObject[i].id ;
            }
            console.log(idArray);
            if(confirm("确定要删除吗？")){
                $.ajax({
                    type : "POST",
                    url : "/brand/batchDelete",
                    data:{
                        idList:idArray
                    },
                    traditional:true,
                    success : function (msg) {
                        console.log(msg);
                        if(msg.code==0){
                            console.log("删除成功");
                            $table.bootstrapTable('refresh');
                        }
                        else {
                            alert("删除失败");
                        }
                    },
                    error:function(){
                        alert("错误");
                    }
                });
            }else{
                console.log("取消删除");
            }

        }
    });

    //    添加品牌按钮功能
    $('#btn_add').click(function () {
        $("#myModal").modal('show');
    });

    //    添加品牌确认按钮
    $('#check').click(function () {
        $.ajax({
            type: "POST",
            url: "/brand/add",
            data: {
                brandName: $('#brand_name').val(),
                brandStatus:$('#brand_status').val(),
            },
            dataType: "json",
            success: function (msg) {
                if(msg.code==0){
                    $('#myModal').modal('hide');
                    $('#brand_name').val("");
                    //$('#brand_status').val("");
                    $table.bootstrapTable('refresh');
                }
                else {
                    alert("添加失败");
                }
            },
            error: function () {
                alert("错误");
            }
        });
    });

    //    修改品牌确认按钮
    $('#update').click(function () {
        $.ajax({
            type: "POST",
            url: "/brand/modify",
            data: {
                brandId: $('#inti_id').val(),
                brandName: $('#new_name').val(),
                brandStatus:$('#new_status').val(),
            },
            dataType: "json",
            success: function (msg) {
                if(msg.code==0){
                    $('#otherModal').modal('hide');
                    $table.bootstrapTable('refresh');
                }
                else {
                    alert("修改失败");
                }
            },
            error: function () {
                alert("错误");
            }
        });
    });

    //查询品牌
    $('#btn_query').click(function () {
        $table.bootstrapTable('refresh');
    });

    //清空条件
    $('#btn_clean').click(function () {
        if($('#txtBrandName').val()!=""||$('#txtStatus').val()!=""){
            $('#txtBrandName').val("");
            $('#txtStatus').val("");
            $table.bootstrapTable('refresh');
		}

    });

</script>
</body>

</html>
